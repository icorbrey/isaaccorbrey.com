---
import { DateTime } from "luxon";
import type { RamblingSummary } from "utils/ramblings";

type Props = {
  highlightNew?: boolean;
  ramblings: RamblingSummary[];
};

const { highlightNew = false, ramblings = [] } = Astro.props;

const isNew = (rambling: RamblingSummary) =>
  highlightNew &&
  !!rambling.publishedAt &&
  DateTime.now().minus({ days: 3 }) <
    DateTime.fromISO(rambling.publishedAt, { zone: "utc" });

const formatDate = (iso?: string) =>
  iso
    ? DateTime.fromISO(iso, { zone: "utc" }).toFormat("yyyy-LL-dd")
    : "";
---

{ramblings.length === 0 ? (
  <p class="text-lg">Nothing here yet.</p>
) : (
  <ul class="w-full flex flex-col gap-1 sm:gap-0.5">
    {ramblings.map((rambling) => (
      <li>
        <a
          href={`/ramblings/${rambling.path}`}
          class="group nounderline flex flex-col gap-0.5 sm:gap-0 sm:flex-row sm:justify-between"
        >
          <span class="text-xl group-hover:underline text-blue-300 group-hover:text-blue-400">
            {rambling.title}
          </span>
          {rambling.publishedAt && isNew(rambling) ? (
            <span class="flex flex-row items-center gap-2 text-base font-medium">
              {formatDate(rambling.publishedAt)}
              <span class="bg-fg-2 text-bg-1 text-[0.6rem] uppercase tracking-wide leading-none rounded px-1 py-0.5">
                New!
              </span>
            </span>
          ) : rambling.publishedAt ? (
            <span class="text-base">{formatDate(rambling.publishedAt)}</span>
          ) : null}
        </a>
      </li>
    ))}
  </ul>
)}
