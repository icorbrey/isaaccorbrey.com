---
title: "Astro: First impressions"
tags: [astro, first-impressions, web-frameworks, zod]
description: |
    My first impressions of Astro, a web framework for content-driven websites.
---

Hey all! This is the first post I've written in a while, and the first that'll
be published on my personal site instead of a site like Medium. I have found
that I barely get anything from posting on Medium, and it's too gamified to
really enjoy posting there anyway. Hopefully having something low-stress like
this site will help me post more.

When I was first trying to get my personal site up and running, I was looking
at frameworks like Gatsby or [Jekyll][jekyll]. However,
[Gatsby looks like it's about dead][gatsby-dead] and I wasn't really looking to
use GitHub pages for Jekyll, as I don't know Ruby and don't really want to
learn. I came across a relatively new framework called [Astro][astro] in my
search and after getting things how I like them, I'm enjoying using it quite a
lot.

## What I like

### Content collections are really cool

I really love Astro's content collections. Rather than have pages fully defined
and routed like you normally might in a bespoke static site like this, you can
place your content in a designated folder at `/src/content`. You keep different
types of data in different folders, kinda like tables in a relational database,
and this data can be markdown files or just plain data in YAML or JSON.

If you're familiar with Obsidian's [Dataview][dataview] plugin, content
collections allow you to interact with your content in a very similar manner.
Astro bundles in a nice schema generation system called [Zod][zod] that lets
you define the schema for your content's frontmatter (or data if it's not a
markdown file). For example, here's the schema definition for this very note:

```ts
import { defineCollection, z } from "astro:content";

export const collections = {
    notes: defineCollection({
        type: 'content',
        schema: z.object({
            tags: z.array(z.string()).default([]),
            publishedOn: z.date().optional(),
            title: z.string(),
        }),
    }),
};
```

### Zod is a lot handier than I expected

I'm writing everything in this project in TypeScript, so having static types
for everything is nice. Normally, I would find myself just writing types for
everything, like for example a query to get notes:

```ts
type GetRecentNotesQuery = {
	includeDrafts?: boolean;
	limit?: number;
}
```

I'd then use this as the type of the query parameter in my function, inserting
any defaults as needed:

```ts
export const getRecentNotes = async (query?: GetRecentNotesQuery) => {
	const includeDrafts = query?.includeDrafts ?? false;
	const limit = query?.limit ?? 10;

	// ...
}
```

However, this can get kind of tedious, as you could potentially forget to set
default values for certain properties. Instead, I've been using Zod for
declaring this, as I can do something really special:

```ts
const recentNotesQuery = z.object({
	includeDrafts: z.boolean().default(false),
	limit: z.number().default(),
});

export const getRecentNotes = async (_query?: z.input<typeof recentNotesQuery>) => {
	const query = recentNotesQuery.parse(_query);

	// ...
}
```

That's right. I can define my static type, runtime validation, and default
values in one statement. Isn't that neat?! I ended up writing a wrapping
function that makes it easier to write this stuff over and over again:

```ts
export const buildQuery = <S extends BaseSchema, T>(
	schema: S,
	fn: (query: z.infer<S>) => Promise<T>
) => {
    return (query: z.input<S>) => fn(schema.parse(query))
}
```

This just takes in the schema I built earlier and a function that expects a
validated query as input. With this, `getRecentNotes` becomes something simple:

```ts
export const getRecentNotes = buildQuery(recentNotesQuery, async (query) => {
	// ...
})
```

I get to use this pattern everywhere, don't have to think about validation, and
I am in love. I will probably be using Zod in other projects from now on.

## What I don't like

TK

## Conclusion

TK

[astro]: https://astro.build
[dataview]: https://blacksmithgu.github.io/obsidian-dataview
[gatsby-dead]: https://github.com/gatsbyjs/gatsby/issues/38696
[jekyll]: https://jekyllrb.com
[zod]: https://zod.dev
